# PART OF QA FOR FOSI 
# (c) LUCIEN SCHREIBER CREALP 2013
cmake_minimum_required(VERSION 2.8)
MESSAGE(STATUS "Using unit testing")

SET ( SRC_TEST_PATH "${CMAKE_CURRENT_LIST_DIR}/../src")

#CONFIGURE_FILE("${SRC_TEST_PATH}/test_param.h.in" "${PROJECT_BINARY_DIR}/test_param.h")
#INCLUDE_DIRECTORIES(${PROJECT_BINARY_DIR})
FILE (GLOB TEST_HEAD_FILES ${SRC_TEST_PATH}/*.h)
SOURCE_GROUP (header FILES ${TEST_HEAD_FILES})

#SET (CXXTEST_PYTHON_TESTGEN_EXECUTABLE "${CXXTEST_INCLUDE_DIR}/bin/cxxtestgen")

# COMPILE FILE AS LIBRARY
SET (PARENT_SRC "${CMAKE_CURRENT_LIST_DIR}/../../src")
SET (TEST_LIBRARY_SRC
  "${PARENT_SRC}/plintoperation.cpp"
  "${PARENT_SRC}/plintoperation.h"
  )
ADD_LIBRARY("${CMAKE_PROJECT_NAME}-testlibrary" STATIC ${TEST_LIBRARY_SRC})

## CXXTEST LIBRARY STUFF
#FIND_PACKAGE(PythonInterp)
SET (CXXTEST_USE_PYTHON 1)
SET (CXXTEST_DIRECTORY "${CXXTEST_INCLUDE_DIR}")
FIND_PACKAGE(CxxTest)
IF (NOT CXXTEST_FOUND)
  MESSAGE(FATAL_ERROR "CxxTest not found, unit testing not possible")
ENDIF (NOT CXXTEST_FOUND)

INCLUDE_DIRECTORIES(${CXXTEST_INCLUDE_DIR})
ENABLE_TESTING()
CXXTEST_ADD_TEST("${CMAKE_PROJECT_NAME}-test" main.cpp ${TEST_HEAD_FILES})
TARGET_LINK_LIBRARIES("${CMAKE_PROJECT_NAME}-test" "${CMAKE_PROJECT_NAME}-testlibrary")
TARGET_LINK_LIBRARIES("${CMAKE_PROJECT_NAME}-test" "${VROOMGIS_LIBRARY}")

#ONLY USED FOR ADDING HEADERS TO PROJECT
IF(APPLE)
  ADD_LIBRARY("dummy_files" SHARED EXCLUDE_FROM_ALL main.cpp ${TEST_HEAD_FILES})
ENDIF(APPLE)

# SHOULD WE USE THE MT VERSION FOR DEFAULT 
# COMPATIBILITY WITH < WINXP
IF (WIN32)
  INCLUDE ("${CMAKE_CURRENT_LIST_DIR}/../../plugins/vroomgis/vroomgis/build/cmake/Use_visualstudioMT.cmake")
ENDIF ()

